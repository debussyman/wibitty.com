{"version":3,"sources":["webpack:///webpack/bootstrap c922d7bfb5e6fe71db69","webpack:///./js/main.js"],"names":["TrainSpeed","Train","name","route","map","icon","firstStop","shift","id","departAt","toString","console","log","position","nextStation","atStation","marker","L","lat","lng","addTo","intervalId","setInterval","updateMarker","move","destroy","latlng","latLng","setLatLng","remove","clearInterval","now","LocalDateTime","isAfter","deltas","howFar","moves","until","minusSeconds","ChronoUnit","MILLIS","deltaLat","deltaLong","SixTrainNorth","FiveTrainSouth","JSJoda","document","addEventListener","mymap","zoomControl","dragging","boxZoom","doubleClickZoom","scrollWheelZoom","setView","tileLayer","attribution","apikey","maxZoom","snroutes","i","length","push","plusSeconds","sixicon","iconUrl","iconSize","fsroutes","fiveicon"],"mappings":"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","file":"main.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap c922d7bfb5e6fe71db69","let TrainSpeed = 200;\n\nclass Train {\n  constructor(name, route, map, icon) {\n    let firstStop = route.shift();\n    this.id = `${name}.${firstStop.departAt.toString()}`;\n    console.log(\"Creating new train\", this.id);\n    this.position = firstStop;\n    this.nextStation = firstStop;\n    this.route = route;\n    this.atStation = true;\n    this.marker = L.marker([this.position.lat, this.position.lng], {icon: icon})\n      .addTo(map);\n    this.intervalId = setInterval(() => this.updateMarker(), TrainSpeed);\n  }\n\n  updateMarker() {\n    this.move();\n    if (this.nextStation == null) {\n      this.destroy();\n    } else {\n      let latlng = L.latLng(this.position.lat, this.position.lng);\n      this.marker.setLatLng(latlng);\n    }\n  }\n\n  destroy() {\n    this.marker.remove();\n    clearInterval(this.intervalId);\n  }\n\n  move() {\n    let now = LocalDateTime.now();\n    if (this.nextStation == null) {\n      console.log(\"Route done\");\n    } else if (this.atStation && this.nextStation.departAt.isAfter(LocalDateTime.now())) {\n      console.log(\"At station, departing\", this.nextStation.departAt.toString());\n    } else if (this.atStation) {\n      console.log(\"Next station\");\n      this.nextStation = this.route.shift();\n      this.atStation = false;\n      this.move();\n    } else {\n      let deltas = this.howFar();\n      // if we are close enough, just move to the station\n      if (deltas[0] == 0 && deltas[1] == 0) {\n        this.atStation = true;\n      } else {\n        this.position = {\n          lat: this.position.lat + deltas[0],\n          lng: this.position.lng + deltas[1]\n        }\n      }\n    }\n  }\n\n  howFar() {\n    let moves = LocalDateTime.now().until(this.nextStation.departAt.minusSeconds(5), ChronoUnit.MILLIS) / TrainSpeed;\n    if (moves < 1) {\n      moves = 1;\n    }\n\n    let deltaLat = (this.nextStation.lat - this.position.lat) / moves;\n    let deltaLong = (this.nextStation.lng - this.position.lng) / moves;\n    return [deltaLat, deltaLong];\n  }\n}\n\nlet SixTrainNorth = [\n  {lat: 40.746664, lng: -73.981891},\n  {lat: 40.752402, lng: -73.977470},\n  {lat: 40.757156, lng: -73.972160},\n  {lat: 40.762845, lng: -73.967535},\n  {lat: 40.762996, lng: -73.967868},\n  {lat: 40.768144, lng: -73.963872},\n  {lat: 40.773522, lng: -73.959746},\n  {lat: 40.779462, lng: -73.955830},\n  {lat: 40.785683, lng: -73.950927},\n  {lat: 40.790192, lng: -73.947682}\n]\n\nlet FiveTrainSouth = [\n  {lat: 40.804406, lng: -73.937221},\n  {lat: 40.779469, lng: -73.955841},\n  {lat: 40.762996, lng: -73.967868},\n  {lat: 40.752399, lng: -73.977470},\n  {lat: 40.735291, lng: -73.991064}\n]\n\nlet LocalDateTime = JSJoda.LocalDateTime;\nlet ChronoUnit = JSJoda.ChronoUnit;\n\ndocument.addEventListener('DOMContentLoaded', () => { \n    let mymap = L.map('mapid', {\n      zoomControl: false,\n      dragging: false,\n      boxZoom: false,\n      doubleClickZoom: false,\n      scrollWheelZoom: false\n    }).setView([40.768, -73.985], 14);\n\n    L.tileLayer('https://{s}.tile.thunderforest.com/pioneer/{z}/{x}/{y}.png?apikey={apikey}', {\n        attribution: '&copy; <a href=\"http://www.thunderforest.com/\">Thunderforest</a>, &copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>',\n        apikey: 'da8d4e6212904e8fbf27c73c7b2a237e',\n        maxZoom: 22\n    }).addTo(mymap);\n\n    let snroutes = [];\n    for(let i=0; i<SixTrainNorth.length; i++) {\n      snroutes.push({\n        lat: SixTrainNorth[i].lat,\n        lng: SixTrainNorth[i].lng,\n        departAt: LocalDateTime.now().plusSeconds(i*20)\n      })\n    }\n    var sixicon = L.icon({\n      iconUrl: 'img/6.png',\n      iconSize: [35, 35],\n    });\n    new Train(\"6N\", snroutes, mymap, sixicon);\n\n    let fsroutes = [];\n    for(let i=0; i<FiveTrainSouth.length; i++) {\n      fsroutes.push({\n        lat: FiveTrainSouth[i].lat,\n        lng: FiveTrainSouth[i].lng,\n        departAt: LocalDateTime.now().plusSeconds(i*35)\n      })\n    }\n    var fiveicon = L.icon({\n      iconUrl: 'img/5.png',\n      iconSize: [35, 35],\n    });\n    new Train(\"5S\", fsroutes, mymap, fiveicon);\n\n}, false);\n\n\n\n// WEBPACK FOOTER //\n// ./js/main.js"],"sourceRoot":""}