{"version":3,"sources":["webpack:///webpack/bootstrap 79163fff2eee157876f4","webpack:///./js/main.js"],"names":["TrainSpeed","Train","data","map","updateData","lastStop","position","lat","lng","status","stop","console","log","icon","L","iconUrl","track","iconSize","marker","addTo","intervalId","setInterval","updateMarker","update","nextStop","next_stop","last_stop","id","move","latlng","latLng","setLatLng","remove","clearInterval","now","Math","round","Date","atStation","arrival","updatePosition","departure","when","deltas","howFar","moves","deltaLat","deltaLng","trains","getTrains","fetch","then","resp","json","Object","keys","forEach","train","key","destroy","document","addEventListener","mymap","zoomControl","dragging","boxZoom","doubleClickZoom","scrollWheelZoom","setView","tileLayer","attribution","apikey","maxZoom"],"mappings":";AAAA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;;AAGA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAAK;AACL;AACA;;AAEA;AACA;AACA;AACA,mCAA2B,0BAA0B,EAAE;AACvD,yCAAiC,eAAe;AAChD;AACA;AACA;;AAEA;AACA,8DAAsD,+DAA+D;;AAErH;AACA;;AAEA;AACA;;;;;;;;;;;;;;AC7DA,IAAIA,aAAa,IAAjB;;IAEMC,K;AACJ,iBAAYC,IAAZ,EAAkBC,GAAlB,EAAuB;AAAA;;AAAA;;AACrB,SAAKC,UAAL,CAAgBF,IAAhB;;AAEA;AACA,QAAG,KAAKG,QAAR,EAAkB;AAChB,WAAKC,QAAL,GAAgB;AACdC,aAAK,KAAKF,QAAL,CAAcE,GADL;AAEdC,aAAK,KAAKH,QAAL,CAAcG;AAFL,OAAhB;AAID,KALD,MAKO;AACL,WAAKC,MAAL,GAAc,YAAd;AACA,WAAKH,QAAL,GAAgB;AACdC,aAAK,KAAKG,IAAL,CAAUH,GADD;AAEdC,aAAK,KAAKE,IAAL,CAAUF;AAFD,OAAhB;AAID;;AAEDG,YAAQC,GAAR,CAAY,oBAAZ,EAAkC,IAAlC;AACA,QAAIC,OAAOC,EAAED,IAAF,CAAO;AAChBE,mFAA2Eb,KAAKc,KAAhF,SADgB;AAEhBC,gBAAU,CAAC,EAAD,EAAK,EAAL;AAFM,KAAP,CAAX;AAIA,SAAKC,MAAL,GAAcJ,EAAEI,MAAF,CAAS,CAAC,KAAKZ,QAAL,CAAcC,GAAf,EAAoB,KAAKD,QAAL,CAAcE,GAAlC,CAAT,EAAiD,EAACK,MAAMA,IAAP,EAAjD,EACXM,KADW,CACLhB,GADK,CAAd;AAEA,SAAKiB,UAAL,GAAkBC,YAAY;AAAA,aAAM,MAAKC,YAAL,EAAN;AAAA,KAAZ,EAAuCtB,UAAvC,CAAlB;AACD;;;;+BAEUuB,M,EAAQ;AACjB,WAAKb,IAAL,GAAYa,OAAOb,IAAnB;AACA,WAAKc,QAAL,GAAgBD,OAAOE,SAAvB;AACA,WAAKpB,QAAL,GAAgBkB,OAAOG,SAAvB;AACA,WAAKjB,MAAL,GAAcc,OAAOd,MAArB;AACA,WAAKkB,EAAL,GAAUJ,OAAOI,EAAjB;AACD;;;gCAEW;AACV,WAAKlB,MAAL,IAAe,YAAf;AACD;;;mCAEc;AACb,WAAKmB,IAAL;AACA,UAAIC,SAASf,EAAEgB,MAAF,CAAS,KAAKxB,QAAL,CAAcC,GAAvB,EAA4B,KAAKD,QAAL,CAAcE,GAA1C,CAAb;AACA,WAAKU,MAAL,CAAYa,SAAZ,CAAsBF,MAAtB;AACD;;;8BAES;AACR,WAAKX,MAAL,CAAYc,MAAZ;AACAC,oBAAc,KAAKb,UAAnB;AACD;;;2BAEM;AACL,UAAIc,MAAMC,KAAKC,KAAL,CAAW,IAAIC,IAAJ,KAAa,IAAxB,CAAV;AACA;AACA,UAAI,CAAC,KAAKC,SAAL,EAAD,IAAqB,KAAK5B,IAAL,CAAU6B,OAAV,GAAoB,CAA7C,EAAgD;AAC9C,aAAKC,cAAL,CAAoBN,GAApB,EAAyB,KAAKxB,IAAL,CAAU6B,OAAnC;AACD,OAFD,MAEO,IAAI,CAAC,KAAKD,SAAL,EAAD,IAAqB,KAAK5B,IAAL,CAAU+B,SAAV,GAAsB,CAA/C,EAAkD;AACvD,aAAKD,cAAL,CAAoBN,GAApB,EAAyB,KAAKxB,IAAL,CAAU+B,SAAV,GAAsB,EAA/C;AACF;AACC,OAHM,MAGA,IAAI,KAAKH,SAAL,MAAoB,KAAK5B,IAAL,CAAU+B,SAAV,GAAsBP,GAA1C,IAAiD,KAAKT,SAAL,IAAkB,IAAvE,EAA6E;AAClF,aAAKhB,MAAL,GAAc,eAAd;AACA,aAAKC,IAAL,GAAY,KAAKe,SAAjB;AACA,aAAKA,SAAL,GAAiB,IAAjB;AACA,aAAKG,IAAL;AACD,OALM,MAKA;AACLjB,gBAAQC,GAAR,CAAY,wBAAZ,EAAsC,IAAtC;AACD;AACF;;;mCAEcsB,G,EAAKQ,I,EAAM;AACxB,UAAIC,SAAS,KAAKC,MAAL,CAAYV,GAAZ,EAAiBQ,IAAjB,CAAb;AACA;AACA,UAAIC,OAAO,CAAP,KAAa,CAAb,IAAkBA,OAAO,CAAP,KAAa,CAAnC,EAAsC;AACpC,aAAKlC,MAAL,IAAe,YAAf;AACD,OAFD,MAEO;AACL,aAAKH,QAAL,GAAgB;AACdC,eAAK,KAAKD,QAAL,CAAcC,GAAd,GAAoBoC,OAAO,CAAP,CADX;AAEdnC,eAAK,KAAKF,QAAL,CAAcE,GAAd,GAAoBmC,OAAO,CAAP;AAFX,SAAhB;AAID;AACF;;;2BAEMT,G,EAAKQ,I,EAAM;AAChB;AACA,UAAIG,QAAQ,CAACH,OAAOR,GAAR,KAAgBlC,aAAa,IAA7B,CAAZ;AACA,UAAI6C,QAAQ,CAAZ,EAAe;AACbA,gBAAQ,CAAR;AACD;;AAED,UAAIC,WAAW,CAAC,KAAKpC,IAAL,CAAUH,GAAV,GAAgB,KAAKD,QAAL,CAAcC,GAA/B,IAAsCsC,KAArD;AACA,UAAIE,WAAW,CAAC,KAAKrC,IAAL,CAAUF,GAAV,GAAgB,KAAKF,QAAL,CAAcE,GAA/B,IAAsCqC,KAArD;AACA,aAAO,CAACC,QAAD,EAAWC,QAAX,CAAP;AACD;;;;;;AAGH,IAAIC,SAAS,EAAb;;AAEA,IAAIC,YAAY,SAAZA,SAAY,CAAC9C,GAAD,EAAS;AACvB+C,QAAM,mDAAN,EACGC,IADH,CACS;AAAA,WAAQC,KAAKC,IAAL,EAAR;AAAA,GADT,EAEGF,IAFH,CAES,kBAAU;AACfG,WAAOC,IAAP,CAAYhC,MAAZ,EAAoBiC,OAApB,CAA6B,eAAO;AAClC,UAAIC,QAAQlC,OAAOmC,GAAP,CAAZ;AACA,UAAIV,OAAOS,MAAM9B,EAAb,CAAJ,EAAsB;AACpBqB,eAAOS,MAAM9B,EAAb,EAAiBvB,UAAjB,CAA4BqD,KAA5B;AACD,OAFD,MAEO;AACLT,eAAOS,MAAM9B,EAAb,IAAmB,IAAI1B,KAAJ,CAAUwD,KAAV,EAAiBtD,GAAjB,CAAnB;AACD;AACF,KAPD;;AASA;AACAmD,WAAOC,IAAP,CAAYP,MAAZ,EAAoBQ,OAApB,CAA6B,eAAO;AAClC,UAAI,CAACjC,OAAOmC,GAAP,CAAL,EAAkB;AAChBV,eAAOU,GAAP,EAAYC,OAAZ;AACA,eAAOX,OAAOU,GAAP,CAAP;AACD;AACF,KALD;AAMD,GAnBH;AAoBD,CArBD;;AAuBAE,SAASC,gBAAT,CAA0B,kBAA1B,EAA8C,YAAM;AAClD,MAAIC,QAAQhD,EAAEX,GAAF,CAAM,OAAN,EAAe;AACzB4D,iBAAa,KADY;AAEzBC,cAAU,KAFe;AAGzBC,aAAS,KAHgB;AAIzBC,qBAAiB,KAJQ;AAKzBC,qBAAiB;AALQ,GAAf,EAMTC,OANS,CAMD,CAAC,MAAD,EAAS,CAAC,MAAV,CANC,EAMkB,EANlB,CAAZ;;AAQAtD,IAAEuD,SAAF,CAAY,4EAAZ,EAA0F;AACxFC,iBAAa,6IAD2E;AAExFC,YAAQ,kCAFgF;AAGxFC,aAAS;AAH+E,GAA1F,EAIGrD,KAJH,CAIS2C,KAJT;;AAMAb,YAAUa,KAAV;AACAzC,cAAY;AAAA,WAAM4B,UAAUa,KAAV,CAAN;AAAA,GAAZ,EAAoC,KAApC;AACD,CAjBD,EAiBG,KAjBH,E","file":"main.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 79163fff2eee157876f4","let TrainSpeed = 2000;\n\nclass Train {\n  constructor(data, map) {\n    this.updateData(data);\n\n    // initially put the train at the known coords of stop\n    if(this.lastStop) {\n      this.position = {\n        lat: this.lastStop.lat,\n        lng: this.lastStop.lng\n      };\n    } else {\n      this.status = \"STOPPED_AT\";\n      this.position = {\n        lat: this.stop.lat,\n        lng: this.stop.lng\n      };\n    }\n\n    console.log(\"Creating new train\", this);\n    let icon = L.icon({\n      iconUrl: `http://www.mta.info/sites/all/themes/mta/images/subway_bullets/${data.track}.png`,\n      iconSize: [16, 16]\n    });\n    this.marker = L.marker([this.position.lat, this.position.lng], {icon: icon})\n      .addTo(map);\n    this.intervalId = setInterval(() => this.updateMarker(), TrainSpeed);\n  }\n\n  updateData(update) {\n    this.stop = update.stop;\n    this.nextStop = update.next_stop;\n    this.lastStop = update.last_stop;\n    this.status = update.status;\n    this.id = update.id;\n  }\n\n  atStation() {\n    this.status == \"STOPPED_AT\";\n  }\n\n  updateMarker() {\n    this.move();\n    let latlng = L.latLng(this.position.lat, this.position.lng);\n    this.marker.setLatLng(latlng);\n  }\n\n  destroy() {\n    this.marker.remove();\n    clearInterval(this.intervalId);\n  }\n\n  move() {\n    let now = Math.round(new Date() / 1000);\n    // not at station but moving towards\n    if (!this.atStation() && this.stop.arrival > 0) {\n      this.updatePosition(now, this.stop.arrival);\n    } else if (!this.atStation() && this.stop.departure > 0) {\n      this.updatePosition(now, this.stop.departure - 30);\n    // at station and departing\n    } else if (this.atStation() && this.stop.departure > now && this.next_stop != null) {\n      this.status = \"IN_TRANSIT_TO\";\n      this.stop = this.next_stop;\n      this.next_stop = null;\n      this.move();\n    } else {\n      console.log(\"Don't know how to move\", this);\n    }\n  }\n\n  updatePosition(now, when) {\n    let deltas = this.howFar(now, when);\n    // if we are close enough, just move to the station\n    if (deltas[0] == 0 && deltas[1] == 0) {\n      this.status == \"STOPPED_AT\";\n    } else {\n      this.position = {\n        lat: this.position.lat + deltas[0],\n        lng: this.position.lng + deltas[1]\n      }\n    }\n  }\n\n  howFar(now, when) {\n    // times are in seconds\n    let moves = (when - now) / (TrainSpeed / 1000);\n    if (moves < 1) {\n      moves = 1;\n    }\n\n    let deltaLat = (this.stop.lat - this.position.lat) / moves;\n    let deltaLng = (this.stop.lng - this.position.lng) / moves;\n    return [deltaLat, deltaLng];\n  }\n}\n\nlet trains = {}\n\nlet getTrains = (map) => {\n  fetch(\"https://s3.amazonaws.com/wibitty.com/js/gtfs.json\")\n    .then( resp => resp.json() )\n    .then( update => {\n      Object.keys(update).forEach( key => {\n        let train = update[key];\n        if (trains[train.id]) {\n          trains[train.id].updateData(train);\n        } else {\n          trains[train.id] = new Train(train, map);\n        }\n      });\n\n      // delete train if no longer in update\n      Object.keys(trains).forEach( key => {\n        if (!update[key]) {\n          trains[key].destroy();\n          delete(trains[key]);\n        }\n      });\n    })\n}\n\ndocument.addEventListener('DOMContentLoaded', () => { \n  let mymap = L.map('mapid', {\n    zoomControl: false,\n    dragging: false,\n    boxZoom: false,\n    doubleClickZoom: false,\n    scrollWheelZoom: false\n  }).setView([40.768, -73.985], 14);\n\n  L.tileLayer('https://{s}.tile.thunderforest.com/pioneer/{z}/{x}/{y}.png?apikey={apikey}', {\n    attribution: '&copy; <a href=\"http://www.thunderforest.com/\">Thunderforest</a>, &copy; <a href=\"http://www.openstreetmap.org/copyright\">OpenStreetMap</a>',\n    apikey: 'da8d4e6212904e8fbf27c73c7b2a237e',\n    maxZoom: 22\n  }).addTo(mymap);\n\n  getTrains(mymap);\n  setInterval(() => getTrains(mymap), 30000);\n}, false);\n\n\n\n// WEBPACK FOOTER //\n// ./js/main.js"],"sourceRoot":""}